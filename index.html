<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Pro | Enterprise Prep</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        .recording-pulse { animation: pulse-ring 1.5s infinite; }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen text-slate-800 relative overflow-hidden">
        
        <div v-if="showSetup" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/90 backdrop-blur">
            <div class="glass-panel p-8 rounded-2xl w-full max-w-md bg-white">
                <h2 class="text-2xl font-bold mb-4 text-slate-900"><i class="fa-solid fa-server mr-2 text-indigo-600"></i>System Setup</h2>
                <p class="mb-4 text-slate-600">Please paste your Google Web App URL to connect to the backend.</p>
                <input v-model="tempApiUrl" type="text" placeholder="https://script.google.com/macros/s/..." class="w-full p-3 rounded border border-slate-300 mb-4 focus:ring-2 focus:ring-indigo-500 outline-none">
                <button @click="saveApiUrl" :disabled="loading" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition">
                    <span v-if="loading"><i class="fa-solid fa-spinner fa-spin mr-2"></i>Connecting...</span>
                    <span v-else>Connect & Save</span>
                </button>
                <p v-if="setupError" class="mt-3 text-red-500 text-sm text-center">{{ setupError }}</p>
            </div>
        </div>

        <div v-if="!token && !showSetup" class="min-h-screen flex items-center justify-center bg-slate-900 relative">
            <div class="absolute inset-0 overflow-hidden">
                <div class="absolute -top-40 -right-40 w-96 h-96 bg-indigo-500 rounded-full blur-3xl opacity-20"></div>
                <div class="absolute top-40 -left-20 w-72 h-72 bg-purple-500 rounded-full blur-3xl opacity-20"></div>
            </div>
            <div class="glass-panel p-8 rounded-2xl w-full max-w-sm z-10">
                <h1 class="text-3xl font-bold text-center mb-2">IELTS Pro</h1>
                <p class="text-center text-slate-500 mb-6">Enterprise Prep Platform</p>
                <form @submit.prevent="login">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1">Username</label>
                        <input v-model="loginForm.username" type="text" class="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-1">Password</label>
                        <input v-model="loginForm.password" type="password" class="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <button type="submit" :disabled="loading" class="w-full bg-indigo-600 text-white py-2 rounded font-semibold hover:bg-indigo-700">
                        <span v-if="loading"><i class="fa-solid fa-spinner fa-spin"></i></span>
                        <span v-else>Sign In</span>
                    </button>
                    <p v-if="errorMsg" class="mt-3 text-red-500 text-sm text-center">{{ errorMsg }}</p>
                </form>
            </div>
        </div>

        <div v-if="token && !showSetup" class="flex h-screen">
            <aside class="w-64 bg-white border-r border-slate-200 flex flex-col">
                <div class="p-6 border-b border-slate-100">
                    <h1 class="text-xl font-bold text-indigo-700"><i class="fa-solid fa-graduation-cap mr-2"></i>IELTS Pro</h1>
                </div>
                <nav class="flex-1 p-4 space-y-2">
                    <button @click="view='dashboard'" :class="view==='dashboard'?'bg-indigo-50 text-indigo-600':''" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-50 font-medium transition"><i class="fa-solid fa-chart-pie w-6"></i> Dashboard</button>
                    <button @click="view='practice'" :class="view==='practice'?'bg-indigo-50 text-indigo-600':''" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-50 font-medium transition"><i class="fa-solid fa-pen-to-square w-6"></i> Practice</button>
                    <button @click="view='analytics'" :class="view==='analytics'?'bg-indigo-50 text-indigo-600':''" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-50 font-medium transition"><i class="fa-solid fa-chart-line w-6"></i> Analytics</button>
                    <button v-if="user.role==='admin'" @click="view='admin'" :class="view==='admin'?'bg-indigo-50 text-indigo-600':''" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-50 font-medium transition"><i class="fa-solid fa-shield-halved w-6"></i> Admin</button>
                </nav>
                <div class="p-4 border-t border-slate-100">
                    <div class="text-xs text-slate-400 mb-2 uppercase font-bold">Settings</div>
                    <button @click="showSetup=true" class="w-full text-left px-4 py-2 text-sm text-slate-600 hover:text-indigo-600"><i class="fa-solid fa-link w-6"></i> Change API</button>
                    <button @click="logout" class="w-full text-left px-4 py-2 text-sm text-red-500 hover:text-red-700"><i class="fa-solid fa-right-from-bracket w-6"></i> Logout</button>
                </div>
            </aside>

            <main class="flex-1 overflow-auto bg-slate-50 relative">
                
                <div v-if="loading" class="absolute inset-0 z-40 bg-white/80 backdrop-blur flex items-center justify-center">
                    <div class="text-center">
                        <i class="fa-solid fa-brain fa-spin text-4xl text-indigo-600 mb-4"></i>
                        <p class="text-slate-600 font-medium">Processing with AI...</p>
                    </div>
                </div>

                <div v-if="view==='dashboard'" class="p-8">
                    <h2 class="text-2xl font-bold mb-6">Welcome back, {{ user.displayName }}</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <div class="text-slate-500 text-sm">Goal Band</div>
                            <div class="text-3xl font-bold text-indigo-600">{{ userProfile.goalBand || 6.5 }}</div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <div class="text-slate-500 text-sm">Mock Exams Left</div>
                            <div class="text-3xl font-bold text-green-600">{{ 2 - (quota.fullMockUsed || 0) }}<span class="text-sm font-normal text-slate-400">/2 this week</span></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <div class="text-slate-500 text-sm">Practice Streak</div>
                            <div class="text-3xl font-bold text-orange-500">{{ userProfile.streakCount || 0 }} <span class="text-sm font-normal text-slate-400">days</span></div>
                        </div>
                    </div>
                </div>

                <div v-if="view==='practice'" class="p-8">
                    <h2 class="text-2xl font-bold mb-6">Select Mode</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition cursor-pointer border border-slate-100" @click="startExamConfig('skill')">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center mr-4"><i class="fa-solid fa-dumbbell text-xl"></i></div>
                                <div>
                                    <h3 class="font-bold text-lg">Skill Practice</h3>
                                    <p class="text-sm text-slate-500">Focus on specific areas</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition cursor-pointer border border-slate-100" @click="generateExam('fullmock', 'full')">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center mr-4"><i class="fa-solid fa-clock text-xl"></i></div>
                                <div>
                                    <h3 class="font-bold text-lg">Full Mock Exam</h3>
                                    <p class="text-sm text-slate-500">Real exam simulation (3h)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="showSkillSelect" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
                    <div class="bg-white rounded-xl p-6 w-96">
                        <h3 class="font-bold text-lg mb-4">Choose Skill</h3>
                        <div class="space-y-2">
                            <button @click="generateExam('skill', 'reading')" class="w-full text-left p-3 rounded hover:bg-slate-100"><i class="fa-solid fa-book-open w-8"></i> Reading</button>
                            <button @click="generateExam('skill', 'listening')" class="w-full text-left p-3 rounded hover:bg-slate-100"><i class="fa-solid fa-headphones w-8"></i> Listening</button>
                            <button @click="generateExam('skill', 'writing')" class="w-full text-left p-3 rounded hover:bg-slate-100"><i class="fa-solid fa-pen-nib w-8"></i> Writing</button>
                            <button @click="generateExam('skill', 'speaking')" class="w-full text-left p-3 rounded hover:bg-slate-100"><i class="fa-solid fa-microphone w-8"></i> Speaking</button>
                        </div>
                        <button @click="showSkillSelect=false" class="mt-4 w-full border border-slate-300 py-2 rounded">Cancel</button>
                    </div>
                </div>

                <div v-if="view==='exam_room' && examData" class="h-full flex flex-col bg-white">
                    <div class="h-16 border-b flex items-center justify-between px-6 bg-slate-50">
                        <span class="font-bold text-lg capitalize">{{ examData.mode }} - {{ examData.skill }}</span>
                        <div class="flex items-center gap-4">
                            <div class="bg-slate-200 px-3 py-1 rounded font-mono">{{ formatTime(timer) }}</div>
                            <button @click="submitExam" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Finish Exam</button>
                        </div>
                    </div>
                    
                    <div class="flex-1 overflow-hidden flex">
                        <div class="w-1/2 p-6 overflow-y-auto border-r border-slate-200 bg-slate-50">
                            <div v-for="(sec, idx) in examData.sections" :key="'L'+idx">
                                <h3 class="font-bold text-xl mb-3">{{ sec.title }}</h3>
                                <p class="mb-4 text-slate-600 italic">{{ sec.instruction }}</p>
                                
                                <div v-if="sec.type==='reading' && sec.passage" class="prose max-w-none mb-8 p-4 bg-white rounded shadow-sm">
                                    <div v-html="sec.passage.replace(/\n/g, '<br>')"></div>
                                </div>

                                <div v-if="sec.type==='listening'" class="mb-8 p-4 bg-white rounded border border-indigo-100">
                                    <button @click="playTTS(sec.audioScript)" class="flex items-center gap-2 bg-indigo-100 text-indigo-700 px-4 py-2 rounded hover:bg-indigo-200">
                                        <i class="fa-solid fa-play"></i> Play Audio
                                    </button>
                                </div>

                                <div v-if="sec.type==='writing'" class="p-4 bg-white rounded border mb-4">
                                     <div v-if="sec.items[0].qType === 'task1_chart' || sec.items[0].qType === 'map'" class="mb-4 h-64 bg-slate-100 flex items-center justify-center rounded">
                                        <div v-if="sec.items[0].map" v-html="sec.items[0].map.svg" class="w-full h-full p-2"></div>
                                        <span v-else class="text-slate-400">[Chart/Graph Placeholder for Task 1]</span>
                                     </div>
                                     <p class="font-medium">{{ sec.items[0].questionText }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="w-1/2 p-6 overflow-y-auto">
                            <div v-for="(sec, sIdx) in examData.sections" :key="'R'+sIdx">
                                <div v-for="(item, qIdx) in sec.items" :key="item.id" class="mb-8 pb-6 border-b border-slate-100">
                                    
                                    <div v-if="item.qType === 'map'" class="mb-4">
                                        <div v-html="item.map.svg" class="w-full h-64 bg-slate-50 mb-2 rounded border"></div>
                                        <p class="font-bold mb-2">{{ item.map.prompt }}</p>
                                    </div>

                                    <div class="flex gap-3">
                                        <span class="font-bold text-slate-400">{{ qIdx + 1 }}.</span>
                                        <div class="flex-1">
                                            <p class="font-medium mb-3" v-if="item.qType!=='writing'">{{ item.questionText }}</p>
                                            
                                            <div v-if="item.qType==='mcq'" class="space-y-2">
                                                <div v-for="(choice, cIdx) in item.choices" :key="cIdx" class="flex items-center">
                                                    <input type="radio" :name="item.id" :value="choice" v-model="answers[item.id]" class="mr-2">
                                                    <span>{{ choice }}</span>
                                                </div>
                                            </div>

                                            <div v-if="item.qType==='tfng'" class="flex gap-4">
                                                <label><input type="radio" :name="item.id" value="TRUE" v-model="answers[item.id]" class="mr-1"> TRUE</label>
                                                <label><input type="radio" :name="item.id" value="FALSE" v-model="answers[item.id]" class="mr-1"> FALSE</label>
                                                <label><input type="radio" :name="item.id" value="NOT GIVEN" v-model="answers[item.id]" class="mr-1"> NOT GIVEN</label>
                                            </div>

                                            <input v-if="['completion','short_answer', 'map'].includes(item.qType)" type="text" v-model="answers[item.id]" class="w-full border p-2 rounded" placeholder="Type answer...">

                                            <textarea v-if="item.qType==='essay' || item.qType==='task1_chart'" v-model="answers[item.id]" rows="10" class="w-full border p-2 rounded" placeholder="Write here..."></textarea>

                                            <div v-if="sec.type==='speaking'" class="mt-2">
                                                <button @click="toggleRecord" :class="isRecording ? 'bg-red-500 recording-pulse' : 'bg-indigo-600'" class="text-white px-4 py-2 rounded-full mb-2 transition-all">
                                                    <i class="fa-solid fa-microphone"></i> {{ isRecording ? 'Recording...' : 'Record Answer' }}
                                                </button>
                                                <textarea v-model="answers[item.id]" rows="3" class="w-full border p-2 rounded text-sm text-slate-600" placeholder="Transcript (auto or manual)..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="showResults && resultData" class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 overflow-y-auto p-4">
                    <div class="bg-white rounded-2xl w-full max-w-4xl p-8 shadow-2xl relative my-8">
                        <button @click="closeResult" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark text-2xl"></i></button>
                        
                        <h2 class="text-3xl font-bold text-center mb-2">Exam Results</h2>
                        <div v-if="resultData.overall" class="text-center text-5xl font-bold text-indigo-600 mb-8">{{ resultData.overall }} <span class="text-lg text-slate-400 font-normal">Overall Band</span></div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center">
                            <div class="p-4 bg-blue-50 rounded-xl">
                                <div class="text-sm text-slate-500">Reading</div>
                                <div class="text-2xl font-bold">{{ resultData.reading.band !== null ? resultData.reading.band : '—' }}</div>
                            </div>
                            <div class="p-4 bg-purple-50 rounded-xl">
                                <div class="text-sm text-slate-500">Listening</div>
                                <div class="text-2xl font-bold">{{ resultData.listening.band !== null ? resultData.listening.band : '—' }}</div>
                            </div>
                            <div class="p-4 bg-green-50 rounded-xl">
                                <div class="text-sm text-slate-500">Writing</div>
                                <div class="text-2xl font-bold">{{ resultData.writing ? resultData.writing.band : '—' }}</div>
                            </div>
                            <div class="p-4 bg-orange-50 rounded-xl">
                                <div class="text-sm text-slate-500">Speaking</div>
                                <div class="text-2xl font-bold">{{ resultData.speaking ? resultData.speaking.band : '—' }}</div>
                            </div>
                        </div>

                        <div class="mb-6" v-if="resultData.feedback">
                            <h3 class="font-bold text-lg mb-2">AI Feedback Summary</h3>
                            <div class="bg-slate-50 p-4 rounded border">
                                <ul class="list-disc pl-5 space-y-1">
                                    <li v-for="(fb, i) in resultData.feedback.feedback || []" :key="i">{{ fb }}</li>
                                    <li v-if="resultData.summary">{{ resultData.summary.overallAdvice }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="view==='admin'" class="p-8">
                    <h2 class="text-2xl font-bold mb-6">User Management</h2>
                    <div class="bg-white rounded-xl shadow overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b">
                                <tr>
                                    <th class="p-4">Username</th>
                                    <th class="p-4">Role</th>
                                    <th class="p-4">Status</th>
                                    <th class="p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="u in adminUsers" :key="u.username" class="border-b">
                                    <td class="p-4">{{ u.username }}</td>
                                    <td class="p-4">{{ u.role }}</td>
                                    <td class="p-4"><span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">Active</span></td>
                                    <td class="p-4">
                                        <button @click="resetQuota(u.username)" class="text-sm bg-slate-100 px-3 py-1 rounded hover:bg-slate-200">Reset Quota</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, reactive } = Vue;

        createApp({
            setup() {
                const token = ref(sessionStorage.getItem('IELTS_PRO_TOKEN'));
                const showSetup = ref(false);
                const tempApiUrl = ref('');
                const loading = ref(false);
                const setupError = ref('');
                
                const loginForm = reactive({ username: '', password: '' });
                const errorMsg = ref('');
                
                const user = ref({});
                const userProfile = ref({});
                const quota = ref({});
                const view = ref('dashboard');
                const adminUsers = ref([]);
                
                const showSkillSelect = ref(false);
                const examData = ref(null);
                const answers = ref({});
                const timer = ref(0);
                const timerInterval = ref(null);
                const isRecording = ref(false);
                
                const showResults = ref(false);
                const resultData = ref(null);

                // API Helper
                const callApi = async (action, payload = {}) => {
                    const apiUrl = localStorage.getItem('IELTS_PRO_API_URL');
                    if (!apiUrl) {
                        showSetup.value = true;
                        throw new Error("API URL missing");
                    }
                    
                    loading.value = true;
                    try {
                        payload.action = action;
                        payload.token = token.value;
                        
                        const formData = new URLSearchParams();
                        formData.append('payload', JSON.stringify(payload));

                        const res = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                            body: formData
                        });
                        const data = await res.json();
                        if (!data.ok) throw new Error(data.error?.message || 'Unknown error');
                        return data.data;
                    } catch (e) {
                        console.error(e);
                        errorMsg.value = e.message;
                        throw e;
                    } finally {
                        loading.value = false;
                    }
                };

                const saveApiUrl = async () => {
                    if (!tempApiUrl.value) return;
                    loading.value = true;
                    try {
                        // Ping check
                        const formData = new URLSearchParams();
                        formData.append('payload', JSON.stringify({ action: 'ping' }));
                        const res = await fetch(tempApiUrl.value, { method: 'POST', body: formData });
                        const data = await res.json();
                        if (data.ok) {
                            localStorage.setItem('IELTS_PRO_API_URL', tempApiUrl.value);
                            showSetup.value = false;
                            setupError.value = '';
                        } else {
                            throw new Error("Ping failed");
                        }
                    } catch (e) {
                        setupError.value = "Invalid URL or Backend not ready.";
                    } finally {
                        loading.value = false;
                    }
                };

                const login = async () => {
                    try {
                        const data = await callApi('login', loginForm);
                        token.value = data.token;
                        user.value = data.user;
                        sessionStorage.setItem('IELTS_PRO_TOKEN', data.token);
                        await fetchMe();
                    } catch (e) {}
                };

                const fetchMe = async () => {
                    const data = await callApi('me');
                    user.value = data.user;
                    quota.value = data.quota;
                    userProfile.value = data.profile;
                    
                    if (user.value.role === 'admin') {
                         const uList = await callApi('adminListUsers');
                         adminUsers.value = uList.users;
                    }
                };

                const logout = () => {
                    token.value = null;
                    sessionStorage.removeItem('IELTS_PRO_TOKEN');
                    user.value = {};
                    view.value = 'dashboard';
                };

                const startExamConfig = (mode) => {
                    if (mode === 'skill') showSkillSelect.value = true;
                };

                const generateExam = async (mode, skill) => {
                    showSkillSelect.value = false;
                    try {
                        const data = await callApi('genExam', { mode, skill });
                        examData.value = data;
                        answers.value = {};
                        view.value = 'exam_room';
                        timer.value = 0;
                        timerInterval.value = setInterval(() => { timer.value++ }, 1000);
                    } catch (e) {
                        alert(e.message);
                    }
                };

                const submitExam = async () => {
                    clearInterval(timerInterval.value);
                    try {
                        const result = await callApi('submitAnswers', {
                            examId: examData.value.examId,
                            answers: answers.value
                        });
                        resultData.value = result;
                        showResults.value = true;
                        await fetchMe(); // refresh quota
                    } catch (e) {
                        alert(e.message);
                    }
                };

                const closeResult = () => {
                    showResults.value = false;
                    view.value = 'dashboard';
                    examData.value = null;
                };

                const formatTime = (seconds) => {
                    const m = Math.floor(seconds / 60);
                    const s = seconds % 60;
                    return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                };

                const playTTS = (text) => {
                    if (!text) return;
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = 'en-GB';
                    window.speechSynthesis.speak(u);
                };

                const toggleRecord = () => {
                    isRecording.value = !isRecording.value;
                    // Mock recording UI logic
                    if(!isRecording.value) alert("Mock recording saved. In a real browser env, this would use MediaRecorder API.");
                };
                
                const resetQuota = async (username) => {
                    if(confirm('Reset quota for ' + username + '?')) {
                        await callApi('adminResetQuota', {username});
                        alert('Reset done');
                    }
                };

                onMounted(async () => {
                    if (!localStorage.getItem('IELTS_PRO_API_URL')) {
                        showSetup.value = true;
                    } else if (token.value) {
                        await fetchMe();
                    }
                });

                return {
                    token, showSetup, tempApiUrl, loading, setupError, loginForm, errorMsg,
                    user, userProfile, quota, view, adminUsers,
                    showSkillSelect, examData, answers, timer, isRecording, showResults, resultData,
                    saveApiUrl, login, logout, startExamConfig, generateExam, submitExam, closeResult,
                    formatTime, playTTS, toggleRecord, resetQuota
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
